local SAFE_FUEL = 50
local MAX_DIAMONDS = 5
local INVENTORY_THRESHOLD = 13
local diamondCount = 0
local steps = 0

-- Trash blocks (vanilla + modded)
local trashBlocks = {
    ["minecraft:cobblestone"]=true,
    ["minecraft:dirt"]=true,
    ["minecraft:sand"]=true,
    ["minecraft:gravel"]=true,
    ["minecraft:stone"]=true,
    ["minecraft:marble"]=true,
    ["modname:cobbedstone"]=true,
    ["modname:granite"]=true
}

function refuelFromChest()
    turtle.turnLeft()
    turtle.turnLeft()
    for i=1,16 do
        turtle.select(i)
        turtle.suck(64)
    end
    turtle.turnLeft()
    turtle.turnLeft()
end

function fuelCheck()
    local f = turtle.getFuelLevel()
    if f == "unlimited" then return end
    if f == nil then f = 0 end
    if f < SAFE_FUEL then
        refuelFromChest()
    end
end

function dumpTrash()
    local fullSlots = 0
    for i=1,16 do
        if turtle.getItemDetail(i) then fullSlots = fullSlots + 1 end
    end
    if fullSlots >= INVENTORY_THRESHOLD then
        for i=1,16 do
            turtle.select(i)
            local item = turtle.getItemDetail()
            if item and trashBlocks[item.name] then turtle.drop() end
        end
    end
end

function countDiamonds()
    local count = 0
    for i=1,16 do
        local item = turtle.getItemDetail(i)
        if item and item.name == "minecraft:diamond" then
            count = count + item.count
        end
    end
    return count
end

function safeForward()
    fuelCheck()
    while turtle.detect() do turtle.dig() end
    turtle.forward()
    steps = steps + 1
end

function mine5x5()
    for y=1,5 do
        for x=1,5 do
            turtle.digUp()
            turtle.digDown()
            safeForward()
            dumpTrash()
        end
        if y < 5 then
            turtle.turnRight()
            safeForward()
            turtle.turnRight()
        end
    end
    for y=1,5 do turtle.back() end
    turtle.turnRight()
    turtle.turnRight()
end

function mine2x2(length)
    for l=1,length do
        for i=1,2 do
            turtle.digUp()
            turtle.digDown()
            safeForward()
            dumpTrash()
            for s=1,16 do
